{"ast":null,"code":"var _jsxFileName = \"/home/quan/code/code_js/goodpicker/frontend/src/pages/new-post/index.js\",\n    _s = $RefreshSig$();\n\nimport './style.scss';\nimport React from 'react';\nimport axios from 'axios';\nimport SiteLayout from '../../components/layouts/site-layout';\nimport { Row, Col, Form, Input, InputNumber, Select, Modal, Alert } from 'antd';\nimport { Link } from 'react-router-dom';\nimport ImageUpload from './image-upload';\nimport Loader from '../../components/elements/loader';\nimport { useAuthState } from '../../hooks/useAuth';\nimport { useHistory } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst newPostReducer = (state, action) => {\n  switch (action.type) {\n    case 'get_categories':\n      return { ...state,\n        categories: action.categories\n      };\n\n    case 'update_files':\n      return { ...state,\n        fileList: action.fileList\n      };\n\n    case 'update_index':\n      return { ...state,\n        mainIndex: action.mainIndex\n      };\n\n    case 'upload_success':\n      return { ...state,\n        status: 'success',\n        message: 'Đăng bài thành công',\n        clear: true\n      };\n\n    case 'upload_fail':\n      return { ...state,\n        status: 'error',\n        message: 'Đã có lỗi trong quá trình đăng bài. Vui lòng kiểm tra thông tin đã nhập'\n      };\n\n    case 'reset_status':\n      return { ...state,\n        status: 'idle'\n      };\n\n    case 'reset_images':\n      return { ...state,\n        clear: false\n      };\n\n    case 'no_images':\n      return { ...state,\n        status: 'error',\n        message: 'Bài đăng cần kèm theo ảnh. Vui lòng thêm ảnh vào bài đăng.'\n      };\n\n    default:\n      throw new Error('Impossible!');\n  }\n};\n\nconst NewPost = () => {\n  _s();\n\n  const rules = {\n    name: [{\n      required: true,\n      message: 'Vui lòng điền tên sản phẩm',\n      whitespace: true\n    }],\n    price: [{\n      required: true,\n      message: 'Vui lòng điền giá sản phẩm'\n    }],\n    category: [{\n      required: true,\n      message: 'Vui lòng chọn một danh mục'\n    }]\n  };\n  const [state, dispatch] = React.useReducer(newPostReducer, {\n    status: 'idle',\n    clear: false,\n    message: null,\n    fileList: [],\n    mainIndex: 0,\n    categories: [],\n    initialValues: {\n      name: '',\n      price: '',\n      category: '',\n      description: ''\n    }\n  });\n  const unmountedRef = React.useRef(false);\n  const [form] = Form.useForm();\n  const {\n    user,\n    cookies\n  } = useAuthState();\n  const history = useHistory();\n  React.useEffect(() => {\n    return () => {\n      unmountedRef.current = true;\n    };\n  }, []);\n  React.useLayoutEffect(() => {\n    if (!user) {\n      history.push('/');\n    }\n\n    const getCategories = async () => {\n      const res = await axios.get('/api/categories');\n\n      if (!unmountedRef.current) {\n        dispatch({\n          type: 'get_categories',\n          categories: res.data\n        });\n      }\n    };\n\n    getCategories();\n  }, [user, history]);\n\n  const onFinish = async values => {\n    if (state.fileList.length === 0) {\n      window.scrollTo(0, 0);\n      return dispatch({\n        type: 'no_images'\n      });\n    }\n\n    let formData = new FormData();\n\n    for (const key in values) {\n      var _values$key;\n\n      formData.append(key, (_values$key = values[key]) !== null && _values$key !== void 0 ? _values$key : '');\n    }\n\n    formData.append('goodsCreateId', user.id);\n    formData.append('goodsLocation', user.userProvinceID.userProvinceName);\n    formData.append('mainIndex', state.mainIndex);\n    state.fileList.forEach((file, i) => formData.append(`images${i}`, file));\n    const modal = Modal.info({\n      className: 'new-post-modal',\n      title: /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"new-post-modal__title\",\n        children: \"\\u0110ang x\\u1EED l\\xFD\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 11\n      }, this),\n      content: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"new-post-modal-content\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: \"B\\xE0i \\u0111\\u0103ng c\\u1EE7a b\\u1EA1n \\u0111ang \\u0111\\u01B0\\u1EE3c x\\u1EED l\\xFD, Vui l\\xF2ng ch\\u1EDD trong gi\\xE2y l\\xE1t.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(Loader, {\n          size: 150\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 5\n      }, this),\n      icon: null,\n      okButtonProps: {\n        hidden: true\n      }\n    });\n\n    try {\n      await axios.post('/api/goods/', formData, {\n        headers: {\n          Authorization: `Bearer ${cookies['gp_token']}`\n        }\n      });\n\n      if (!unmountedRef.current) {\n        form.resetFields();\n        dispatch({\n          type: 'upload_success'\n        });\n      }\n    } catch (error) {\n      if (!unmountedRef.current) {\n        dispatch({\n          type: 'upload_fail'\n        });\n      }\n    } finally {\n      window.scrollTo(0, 0);\n\n      if (!unmountedRef.current) {\n        modal.destroy();\n      }\n    }\n  };\n\n  const updateFileList = fileList => {\n    dispatch({\n      type: 'update_files',\n      fileList\n    });\n  };\n\n  const updateMainIndex = mainIndex => {\n    dispatch({\n      type: 'update_index',\n      mainIndex\n    });\n  };\n\n  const resetClear = React.useCallback(() => {\n    dispatch({\n      type: 'reset_images'\n    });\n  }, []);\n\n  const onAlertClose = () => {\n    dispatch({\n      type: 'reset_status'\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(SiteLayout, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"new-post\",\n      children: [state.message ? /*#__PURE__*/_jsxDEV(Alert, {\n        className: `new-post__alert new-post__alert--${state.status}`,\n        message: state.message,\n        type: state.status,\n        closable: true,\n        onClose: onAlertClose\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 6\n      }, this) : null, /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"low-bradius-formpage__title\",\n        children: \"T\\u1EA1o b\\xE0i \\u0111\\u0103ng m\\u1EDBi\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(Form, {\n        className: \"low-bradius-formpage-form\",\n        layout: \"vertical\",\n        form: form,\n        onFinish: onFinish,\n        scrollToFirstError: true,\n        initialValues: state.initialValues,\n        children: [/*#__PURE__*/_jsxDEV(Row, {\n          gutter: {\n            xs: 8,\n            sm: 16,\n            md: 24,\n            lg: 32\n          },\n          children: [/*#__PURE__*/_jsxDEV(Col, {\n            xs: 24,\n            md: {\n              span: 12,\n              push: 12\n            },\n            children: /*#__PURE__*/_jsxDEV(ImageUpload, {\n              className: \"new-post-upload\",\n              updateFileList: updateFileList,\n              updateMainIndex: updateMainIndex,\n              clear: state.clear,\n              resetClear: resetClear\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 202,\n              columnNumber: 8\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 201,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(Col, {\n            xs: 24,\n            md: {\n              span: 12,\n              pull: 12\n            },\n            children: [/*#__PURE__*/_jsxDEV(Form.Item, {\n              label: \"T\\xEAn m\\xF3n \\u0111\\u1ED3\",\n              name: \"goodsName\",\n              rules: rules.name,\n              children: /*#__PURE__*/_jsxDEV(Input, {\n                spellCheck: false,\n                className: \"low-bradius-formpage-form__input\",\n                type: \"text\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 212,\n                columnNumber: 9\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 211,\n              columnNumber: 8\n            }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n              label: \"Gi\\xE1 m\\xF3n \\u0111\\u1ED3 (VN\\u0110)\",\n              name: \"goodsPrice\",\n              rules: rules.price,\n              children: /*#__PURE__*/_jsxDEV(InputNumber, {\n                className: \"low-bradius-formpage-form__input\",\n                min: 0,\n                step: 10000,\n                formatter: value => `${value}`.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ','),\n                parser: value => value.replace(/[^\\d]/g, '')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 224,\n                columnNumber: 9\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 219,\n              columnNumber: 8\n            }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n              label: \"Danh m\\u1EE5c\",\n              name: \"goodsCategoryID\",\n              rules: rules.category,\n              children: /*#__PURE__*/_jsxDEV(Select, {\n                className: \"low-bradius-formpage-form__select\",\n                children: state.categories.map(category => /*#__PURE__*/_jsxDEV(Select.Option, {\n                  value: category.goodsCategoryID,\n                  children: category.goodsCategoryName\n                }, category.goodsCategoryName, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 242,\n                  columnNumber: 11\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 240,\n                columnNumber: 9\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 235,\n              columnNumber: 8\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 210,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n          label: \"M\\xF4 t\\u1EA3\",\n          name: \"goodsDescription\",\n          children: /*#__PURE__*/_jsxDEV(Input.TextArea, {\n            spellCheck: false,\n            className: \"low-bradius-formpage-form__input low-bradius-formpage-form__input--area\",\n            rows: 7,\n            maxLength: 600\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 255,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 254,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"low-bradius-formpage-form-submit\",\n          children: [/*#__PURE__*/_jsxDEV(Link, {\n            to: \"/profile\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"low-bradius-formpage-form-submit__btn low-bradius-formpage-form-submit__btn--cancel\",\n              children: \"H\\u1EE7y\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 265,\n              columnNumber: 8\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 264,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"low-bradius-formpage-form-submit__btn low-bradius-formpage-form-submit__btn--submit\",\n            type: \"submit\",\n            children: \"\\u0110\\u0103ng b\\xE0i\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 270,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 4\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 178,\n    columnNumber: 3\n  }, this);\n};\n\n_s(NewPost, \"354hKIBbEWxZghH1cTaOtpmKjJ0=\", false, function () {\n  return [Form.useForm, useAuthState, useHistory];\n});\n\n_c = NewPost;\nexport default NewPost;\n\nvar _c;\n\n$RefreshReg$(_c, \"NewPost\");","map":{"version":3,"sources":["/home/quan/code/code_js/goodpicker/frontend/src/pages/new-post/index.js"],"names":["React","axios","SiteLayout","Row","Col","Form","Input","InputNumber","Select","Modal","Alert","Link","ImageUpload","Loader","useAuthState","useHistory","newPostReducer","state","action","type","categories","fileList","mainIndex","status","message","clear","Error","NewPost","rules","name","required","whitespace","price","category","dispatch","useReducer","initialValues","description","unmountedRef","useRef","form","useForm","user","cookies","history","useEffect","current","useLayoutEffect","push","getCategories","res","get","data","onFinish","values","length","window","scrollTo","formData","FormData","key","append","id","userProvinceID","userProvinceName","forEach","file","i","modal","info","className","title","content","icon","okButtonProps","hidden","post","headers","Authorization","resetFields","error","destroy","updateFileList","updateMainIndex","resetClear","useCallback","onAlertClose","xs","sm","md","lg","span","pull","value","replace","map","goodsCategoryID","goodsCategoryName"],"mappings":"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","sourcesContent":["import './style.scss'\n\nimport React from 'react'\nimport axios from 'axios'\nimport SiteLayout from '../../components/layouts/site-layout'\nimport { Row, Col, Form, Input, InputNumber, Select, Modal, Alert } from 'antd'\nimport { Link } from 'react-router-dom'\nimport ImageUpload from './image-upload'\nimport Loader from '../../components/elements/loader'\nimport { useAuthState } from '../../hooks/useAuth'\nimport { useHistory } from 'react-router-dom'\n\nconst newPostReducer = (state, action) => {\n\tswitch (action.type) {\n\t\tcase 'get_categories':\n\t\t\treturn { ...state, categories: action.categories }\n\t\tcase 'update_files':\n\t\t\treturn { ...state, fileList: action.fileList }\n\t\tcase 'update_index':\n\t\t\treturn { ...state, mainIndex: action.mainIndex }\n\t\tcase 'upload_success':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstatus: 'success',\n\t\t\t\tmessage: 'Đăng bài thành công',\n\t\t\t\tclear: true\n\t\t\t}\n\t\tcase 'upload_fail':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstatus: 'error',\n\t\t\t\tmessage:\n\t\t\t\t\t'Đã có lỗi trong quá trình đăng bài. Vui lòng kiểm tra thông tin đã nhập'\n\t\t\t}\n\t\tcase 'reset_status':\n\t\t\treturn { ...state, status: 'idle' }\n\t\tcase 'reset_images':\n\t\t\treturn { ...state, clear: false }\n\t\tcase 'no_images':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstatus: 'error',\n\t\t\t\tmessage: 'Bài đăng cần kèm theo ảnh. Vui lòng thêm ảnh vào bài đăng.'\n\t\t\t}\n\t\tdefault:\n\t\t\tthrow new Error('Impossible!')\n\t}\n}\n\nconst NewPost = () => {\n\tconst rules = {\n\t\tname: [\n\t\t\t{\n\t\t\t\trequired: true,\n\t\t\t\tmessage: 'Vui lòng điền tên sản phẩm',\n\t\t\t\twhitespace: true\n\t\t\t}\n\t\t],\n\t\tprice: [{ required: true, message: 'Vui lòng điền giá sản phẩm' }],\n\t\tcategory: [{ required: true, message: 'Vui lòng chọn một danh mục' }]\n\t}\n\n\tconst [state, dispatch] = React.useReducer(newPostReducer, {\n\t\tstatus: 'idle',\n\t\tclear: false,\n\t\tmessage: null,\n\t\tfileList: [],\n\t\tmainIndex: 0,\n\t\tcategories: [],\n\t\tinitialValues: {\n\t\t\tname: '',\n\t\t\tprice: '',\n\t\t\tcategory: '',\n\t\t\tdescription: ''\n\t\t}\n\t})\n\n\tconst unmountedRef = React.useRef(false)\n\tconst [form] = Form.useForm()\n\tconst { user, cookies } = useAuthState()\n\tconst history = useHistory()\n\n\tReact.useEffect(() => {\n\t\treturn () => {\n\t\t\tunmountedRef.current = true\n\t\t}\n\t}, [])\n\n\tReact.useLayoutEffect(() => {\n\t\tif (!user) {\n\t\t\thistory.push('/')\n\t\t}\n\n\t\tconst getCategories = async () => {\n\t\t\tconst res = await axios.get('/api/categories')\n\n\t\t\tif (!unmountedRef.current) {\n\t\t\t\tdispatch({ type: 'get_categories', categories: res.data })\n\t\t\t}\n\t\t}\n\t\tgetCategories()\n\t}, [user, history])\n\n\tconst onFinish = async values => {\n\t\tif (state.fileList.length === 0) {\n\t\t\twindow.scrollTo(0, 0)\n\t\t\treturn dispatch({ type: 'no_images' })\n\t\t}\n\n\t\tlet formData = new FormData()\n\n\t\tfor (const key in values) {\n\t\t\tformData.append(key, values[key] ?? '')\n\t\t}\n\n\t\tformData.append('goodsCreateId', user.id)\n\t\tformData.append('goodsLocation', user.userProvinceID.userProvinceName)\n\t\tformData.append('mainIndex', state.mainIndex)\n\n\t\tstate.fileList.forEach((file, i) => formData.append(`images${i}`, file))\n\n\t\tconst modal = Modal.info({\n\t\t\tclassName: 'new-post-modal',\n\t\t\ttitle: <span className=\"new-post-modal__title\">Đang xử lý</span>,\n\t\t\tcontent: (\n\t\t\t\t<div className=\"new-post-modal-content\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\tBài đăng của bạn đang được xử lý, Vui lòng chờ trong giây lát.\n\t\t\t\t\t</div>\n\t\t\t\t\t<Loader size={150} />\n\t\t\t\t</div>\n\t\t\t),\n\t\t\ticon: null,\n\t\t\tokButtonProps: { hidden: true }\n\t\t})\n\n\t\ttry {\n\t\t\tawait axios.post('/api/goods/', formData, {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${cookies['gp_token']}`\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tif (!unmountedRef.current) {\n\t\t\t\tform.resetFields()\n\t\t\t\tdispatch({ type: 'upload_success' })\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tif (!unmountedRef.current) {\n\t\t\t\tdispatch({ type: 'upload_fail' })\n\t\t\t}\n\t\t} finally {\n\t\t\twindow.scrollTo(0, 0)\n\n\t\t\tif (!unmountedRef.current) {\n\t\t\t\tmodal.destroy()\n\t\t\t}\n\t\t}\n\t}\n\n\tconst updateFileList = fileList => {\n\t\tdispatch({ type: 'update_files', fileList })\n\t}\n\n\tconst updateMainIndex = mainIndex => {\n\t\tdispatch({ type: 'update_index', mainIndex })\n\t}\n\n\tconst resetClear = React.useCallback(() => {\n\t\tdispatch({ type: 'reset_images' })\n\t}, [])\n\n\tconst onAlertClose = () => {\n\t\tdispatch({ type: 'reset_status' })\n\t}\n\n\treturn (\n\t\t<SiteLayout>\n\t\t\t<div className=\"new-post\">\n\t\t\t\t{state.message ? (\n\t\t\t\t\t<Alert\n\t\t\t\t\t\tclassName={`new-post__alert new-post__alert--${state.status}`}\n\t\t\t\t\t\tmessage={state.message}\n\t\t\t\t\t\ttype={state.status}\n\t\t\t\t\t\tclosable\n\t\t\t\t\t\tonClose={onAlertClose}\n\t\t\t\t\t/>\n\t\t\t\t) : null}\n\n\t\t\t\t<div className=\"low-bradius-formpage__title\">Tạo bài đăng mới</div>\n\n\t\t\t\t<Form\n\t\t\t\t\tclassName=\"low-bradius-formpage-form\"\n\t\t\t\t\tlayout=\"vertical\"\n\t\t\t\t\tform={form}\n\t\t\t\t\tonFinish={onFinish}\n\t\t\t\t\tscrollToFirstError\n\t\t\t\t\tinitialValues={state.initialValues}\n\t\t\t\t>\n\t\t\t\t\t<Row gutter={{ xs: 8, sm: 16, md: 24, lg: 32 }}>\n\t\t\t\t\t\t<Col xs={24} md={{ span: 12, push: 12 }}>\n\t\t\t\t\t\t\t<ImageUpload\n\t\t\t\t\t\t\t\tclassName=\"new-post-upload\"\n\t\t\t\t\t\t\t\tupdateFileList={updateFileList}\n\t\t\t\t\t\t\t\tupdateMainIndex={updateMainIndex}\n\t\t\t\t\t\t\t\tclear={state.clear}\n\t\t\t\t\t\t\t\tresetClear={resetClear}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t<Col xs={24} md={{ span: 12, pull: 12 }}>\n\t\t\t\t\t\t\t<Form.Item label=\"Tên món đồ\" name=\"goodsName\" rules={rules.name}>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tspellCheck={false}\n\t\t\t\t\t\t\t\t\tclassName=\"low-bradius-formpage-form__input\"\n\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</Form.Item>\n\n\t\t\t\t\t\t\t<Form.Item\n\t\t\t\t\t\t\t\tlabel=\"Giá món đồ (VNĐ)\"\n\t\t\t\t\t\t\t\tname=\"goodsPrice\"\n\t\t\t\t\t\t\t\trules={rules.price}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<InputNumber\n\t\t\t\t\t\t\t\t\tclassName=\"low-bradius-formpage-form__input\"\n\t\t\t\t\t\t\t\t\tmin={0}\n\t\t\t\t\t\t\t\t\tstep={10000}\n\t\t\t\t\t\t\t\t\tformatter={value =>\n\t\t\t\t\t\t\t\t\t\t`${value}`.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tparser={value => value.replace(/[^\\d]/g, '')}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</Form.Item>\n\n\t\t\t\t\t\t\t<Form.Item\n\t\t\t\t\t\t\t\tlabel=\"Danh mục\"\n\t\t\t\t\t\t\t\tname=\"goodsCategoryID\"\n\t\t\t\t\t\t\t\trules={rules.category}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Select className=\"low-bradius-formpage-form__select\">\n\t\t\t\t\t\t\t\t\t{state.categories.map(category => (\n\t\t\t\t\t\t\t\t\t\t<Select.Option\n\t\t\t\t\t\t\t\t\t\t\tkey={category.goodsCategoryName}\n\t\t\t\t\t\t\t\t\t\t\tvalue={category.goodsCategoryID}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{category.goodsCategoryName}\n\t\t\t\t\t\t\t\t\t\t</Select.Option>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t\t</Form.Item>\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t</Row>\n\n\t\t\t\t\t<Form.Item label=\"Mô tả\" name=\"goodsDescription\">\n\t\t\t\t\t\t<Input.TextArea\n\t\t\t\t\t\t\tspellCheck={false}\n\t\t\t\t\t\t\tclassName=\"low-bradius-formpage-form__input low-bradius-formpage-form__input--area\"\n\t\t\t\t\t\t\trows={7}\n\t\t\t\t\t\t\tmaxLength={600}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Form.Item>\n\n\t\t\t\t\t<div className=\"low-bradius-formpage-form-submit\">\n\t\t\t\t\t\t<Link to=\"/profile\">\n\t\t\t\t\t\t\t<button className=\"low-bradius-formpage-form-submit__btn low-bradius-formpage-form-submit__btn--cancel\">\n\t\t\t\t\t\t\t\tHủy\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Link>\n\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclassName=\"low-bradius-formpage-form-submit__btn low-bradius-formpage-form-submit__btn--submit\"\n\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tĐăng bài\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</Form>\n\t\t\t</div>\n\t\t</SiteLayout>\n\t)\n}\n\nexport default NewPost\n"]},"metadata":{},"sourceType":"module"}